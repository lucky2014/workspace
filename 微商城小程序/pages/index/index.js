const utils = require("../../utils/util.js");
const addToCar = require("../../utils/addToCar.js");
Page({
  data: {
    firstIndex: -1,
    attrValueList: [],
    showCar: 0,
    selectNum: 1
  },
  onLoad: function(event) {
    var me = this;
    //店铺信息
    utils.ajaxFn("store/getStoreInfo.do", "", function(msg) {
      
      var msg={
            "backPic": "http://122.224.214.231:8001/group1/M00/00/97/wKgCRFoRc9-Aem0JAAF91j2dkSg051.jpg",
            "contactPhone": "18768198044",
            "contactPhoneSub": "18768198044",
            "createTime": 1511164878000,
            "htmlUrl": "https://store.yinnima.com/micro-store-cus/index/viewStore/3/caiyuanbao",
            "id": 3,
            "incrPersent": 20,
            "incrType": 1,
            "isCertification": 1,
            "isDelete": "n",
            "modifyTime": 1513959120000,
            "resource": "caiyuanbao",
            "shortIntro": "只要你要，只要我有。",
            "status": 1,
            "storeLogo": "http://122.224.218.61:8001/group1/M00/00/C8/wKgCClo8YMSATN26AACnvO7DsO467.jpeg?filename=10236728303242952.jpeg",
            "storeName": "满天星",
            "templateId": 22,
            "userId": 154,
            "wxQrUrl": "http://122.224.218.61:8001/group1/M00/00/BD/wKgCCloop_CADJlqAAGpu5zrkA0324.png",
            "zfbQrUrl": "http://122.224.218.61:8001/group1/M00/00/C8/wKgCClo8XaOAEIIKAAIBnSz3B5Q45.jpeg?filename=10235926843847187.jpeg"
          };
      me.setData({
        storeData: msg
      });

      wx.setNavigationBarTitle({
         title: msg.storeName//页面标题为路由参数
       })
      
    //模块列表
    me.listStoreModules();
    });
  },
  listStoreModules:function(){
    var me = this;
    utils.ajaxFn("modules/listStoreModules.do", "", function(msg) {
      
      var msg = {
          "styleData": {
            "titlePicR": "<svg width='18px' height='18px' viewBox='0 0 18 18' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='h2Pic'>\r\n\t<g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'>\r\n\t<g transform='translate(-236.000000, -433.000000)' fill-rule='nonzero' >\r\n\t<g transform='translate(237.000000, 434.000000)'>\r\n\t<path d='M15.9002194,0.140495608 C15.816919,0.0468318694 15.7127934,0 15.5878428,0 L15.1815033,0 C13.4528528,0 12.1616961,0.00516650517 11.3080333,0.0154995155 C10.4543705,0.0258325258 9.47825609,0.0753309786 8.37969003,0.163994874 C7.28112396,0.252658769 6.36215362,0.38548795 5.622779,0.562482417 C4.38360182,0.854139967 3.39432591,1.31762548 2.6549513,1.95293897 C1.85326796,2.62991782 1.29615469,3.54138934 0.983611478,4.68735353 C0.858660835,5.02067644 0.796185514,5.53632699 0.796185514,6.23430519 C0.796185514,6.93228338 0.895146423,7.59892921 1.09306824,8.23424269 C1.24933985,8.7552264 1.48891188,9.2395446 1.81178434,9.68719728 C0.603928114,11.5724717 0,13.5412435 0,15.5935127 C0,15.6561774 0.010495854,15.7108424 0.0314875621,15.7575076 C0.0524792701,15.8041728 0.0811346176,15.8458382 0.117453605,15.8825037 C0.153772591,15.9191692 0.195422806,15.947835 0.242404248,15.968501 C0.28938569,15.989167 0.344030771,15.9996667 0.406339492,16 C0.479310667,16 0.544451602,15.9818339 0.601762297,15.9455017 C0.659072992,15.9091695 0.705887833,15.8596711 0.74220682,15.7970063 C0.778525807,15.7343416 0.796685301,15.6666771 0.796685301,15.5940127 C0.796685301,14.8960345 0.877320116,14.2007229 1.03858975,13.5080779 C1.19985938,12.8154329 1.40028021,12.203452 1.63985224,11.6721353 C1.87942427,11.1408185 2.16581115,10.6173349 2.49901286,10.1016843 C2.83221458,9.58603378 3.13676095,9.16154704 3.41265198,8.82822412 C3.68854301,8.49490119 3.9774289,8.18241096 4.27930964,7.89075341 C5.23726458,6.93245002 6.25769485,6.17197379 7.34060043,5.60932471 C7.83007375,5.34899951 8.30388659,5.14850578 8.76203896,5.00784351 C9.22019133,4.86718124 9.63152885,4.7968501 9.99605153,4.7968501 L10.0585269,4.7968501 C10.0795186,4.7968501 10.1003437,4.7916836 10.1210022,4.78135059 C10.1416607,4.77101758 10.1624858,4.76318449 10.1834775,4.75785132 C10.2044692,4.75251816 10.2252943,4.73951856 10.2459528,4.71885254 L10.2774404,4.68735353 C10.2984321,4.66635418 10.3140926,4.6455215 10.3244218,4.62485548 L10.3559094,4.59335646 C10.3662386,4.57235712 10.3714033,4.55152444 10.3714033,4.53085842 L10.4028908,4.46836037 L10.4028908,4.40586232 C10.4028908,4.29119924 10.3639062,4.19486892 10.285937,4.11687136 C10.2079678,4.0388738 10.1116725,3.99987502 9.99705113,3.99987502 C9.55955728,3.99987502 9.08574444,4.07537266 8.5756126,4.22636794 C8.06548077,4.37736322 7.5291926,4.59868963 6.96674811,4.89034718 C5.81087135,5.50499464 4.72796576,6.31230275 3.71803135,7.31227149 C3.20789953,7.8332552 2.73408668,8.38540462 2.29659282,8.96871973 C2.098671,8.66672917 1.95289525,8.34907242 1.85926557,8.0157495 C1.73431493,7.60942887 1.65617912,7.18760871 1.62485816,6.75028904 C1.5935372,6.31296937 1.59087159,5.94831409 1.61686132,5.65632322 C1.64285106,5.36433235 1.68716688,5.11434016 1.74980881,4.90634666 C1.87475945,4.45836067 2.04919055,4.05204003 2.2731021,3.68738475 C2.49701365,3.32272947 2.72875545,3.00507273 2.96832748,2.73441453 C3.20789951,2.46375632 3.55159709,2.22676373 3.9994202,2.02343675 C4.44724332,1.82010977 4.84025474,1.64828181 5.17845449,1.50795286 C5.51665423,1.36762392 6.02428704,1.25296083 6.70135294,1.16396362 C7.37841884,1.0749664 7.93803112,1.00463526 8.3801898,0.952970211 C8.82234847,0.90130516 9.49658215,0.864806301 10.4028908,0.843473634 C11.3091995,0.822140968 12.0407439,0.809141374 12.5975239,0.804474853 C13.154304,0.799808332 13.9951385,0.797141749 15.1200275,0.796475103 C14.1724018,5.84831723 12.4334221,9.07738299 9.90308824,10.4836724 C9.36163545,10.7856629 8.79669194,10.9966563 8.2082577,11.1166526 C7.61982346,11.2366488 7.07320604,11.2679812 6.56840544,11.2106496 C6.06360484,11.1533181 5.64193807,11.0856536 5.30340511,11.007656 C4.96487216,10.9296584 4.64982993,10.8281616 4.35827843,10.7031655 C4.31662822,10.6821662 4.26981338,10.6613335 4.21783391,10.6406675 L4.09288327,10.5781694 C4.0409038,10.5571701 3.99142334,10.5336708 3.9444419,10.5076716 C3.89746046,10.4816724 3.85314463,10.4530067 3.81149442,10.4216743 C3.79050271,10.4113413 3.76701199,10.4008416 3.74102226,10.3901753 C3.71503252,10.379509 3.6915418,10.3743425 3.67055009,10.3746758 L3.53010557,10.3746758 C3.50911386,10.3746758 3.48828875,10.3798423 3.46763025,10.3901753 L3.40515493,10.4216743 C3.38416322,10.4320073 3.36333811,10.4476735 3.34267961,10.4686728 L3.31119204,10.5001719 C3.29020034,10.5211712 3.27453985,10.5420039 3.2642106,10.5626699 C3.22256039,10.6253346 3.20173528,10.6929992 3.20173528,10.7656636 C3.20173528,10.838328 3.21989477,10.9059925 3.25621376,10.9686572 C3.29253275,11.0313219 3.33684858,11.0781538 3.38916124,11.1091528 C3.60774157,11.2444819 3.83165312,11.359145 4.0608959,11.4531421 C4.78994127,11.7447996 5.55530561,11.9271273 6.35698894,12.000125 C6.39863915,12.000125 6.44028936,12.0027916 6.48193958,12.0081247 C6.52358979,12.0134579 6.57040463,12.0161245 6.6223841,12.0161245 L6.74733475,12.0161245 C6.78898496,12.0161245 6.83063517,12.0187911 6.87228539,12.0241242 C6.9139356,12.0294574 6.95558582,12.032124 6.99723603,12.032124 C8.18443375,12.032124 9.28299982,11.7507994 10.2929342,11.1881504 C11.5840909,10.4695061 12.6878216,9.3185421 13.6041263,7.73525825 C14.1352498,6.81862023 14.6012324,5.75098692 15.0020741,4.53235834 C15.4029158,3.31372976 15.7334519,1.95960541 15.9936824,0.469985293 C16.0146741,0.3449892 15.9833532,0.235659285 15.8997195,0.141995546 L15.9002194,0.140495608 Z' class='svgTheme'></path>\r\n\t</g>\r\n\t</g>\r\n\t</g>\r\n\t</svg>",
            "margin": "0 15px",
            "themeImg": {
              "titleLpng": "http://122.224.214.231:8001/group1/M00/01/4A/wKgCRFpNirqAH20HAAAGCI15aqU931.png",
              "addresspng": "http://122.224.214.231:8001/group1/M00/01/4A/wKgCRFpNisOADZneAAAKV-TdMZo874.png",
              "titleRpng": "http://122.224.214.231:8001/group1/M00/01/4A/wKgCRFpNir-AX0q-AAAFw768qZU941.png"
            },
            "typeId": "thirdPics",
            "titlePicL": "<svg width='18px' height='18px' viewBox='0 0 18 18' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='h2Pic'>\r\n\t<g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'>\r\n\t<g transform='translate(-122.000000, -433.000000)' fill-rule='nonzero'>\r\n\t<g transform='translate(131.000000, 442.000000) scale(-1, 1) translate(-131.000000, -442.000000) translate(123.000000, 434.000000)'>\r\n\t<path d='M15.9002194,0.140495608 C15.816919,0.0468318694 15.7127934,0 15.5878428,0 L15.1815033,0 C13.4528528,0 12.1616961,0.00516650517 11.3080333,0.0154995155 C10.4543705,0.0258325258 9.47825609,0.0753309786 8.37969003,0.163994874 C7.28112396,0.252658769 6.36215362,0.38548795 5.622779,0.562482417 C4.38360182,0.854139967 3.39432591,1.31762548 2.6549513,1.95293897 C1.85326796,2.62991782 1.29615469,3.54138934 0.983611478,4.68735353 C0.858660835,5.02067644 0.796185514,5.53632699 0.796185514,6.23430519 C0.796185514,6.93228338 0.895146423,7.59892921 1.09306824,8.23424269 C1.24933985,8.7552264 1.48891188,9.2395446 1.81178434,9.68719728 C0.603928114,11.5724717 0,13.5412435 0,15.5935127 C0,15.6561774 0.010495854,15.7108424 0.0314875621,15.7575076 C0.0524792701,15.8041728 0.0811346176,15.8458382 0.117453605,15.8825037 C0.153772591,15.9191692 0.195422806,15.947835 0.242404248,15.968501 C0.28938569,15.989167 0.344030771,15.9996667 0.406339492,16 C0.479310667,16 0.544451602,15.9818339 0.601762297,15.9455017 C0.659072992,15.9091695 0.705887833,15.8596711 0.74220682,15.7970063 C0.778525807,15.7343416 0.796685301,15.6666771 0.796685301,15.5940127 C0.796685301,14.8960345 0.877320116,14.2007229 1.03858975,13.5080779 C1.19985938,12.8154329 1.40028021,12.203452 1.63985224,11.6721353 C1.87942427,11.1408185 2.16581115,10.6173349 2.49901286,10.1016843 C2.83221458,9.58603378 3.13676095,9.16154704 3.41265198,8.82822412 C3.68854301,8.49490119 3.9774289,8.18241096 4.27930964,7.89075341 C5.23726458,6.93245002 6.25769485,6.17197379 7.34060043,5.60932471 C7.83007375,5.34899951 8.30388659,5.14850578 8.76203896,5.00784351 C9.22019133,4.86718124 9.63152885,4.7968501 9.99605153,4.7968501 L10.0585269,4.7968501 C10.0795186,4.7968501 10.1003437,4.7916836 10.1210022,4.78135059 C10.1416607,4.77101758 10.1624858,4.76318449 10.1834775,4.75785132 C10.2044692,4.75251816 10.2252943,4.73951856 10.2459528,4.71885254 L10.2774404,4.68735353 C10.2984321,4.66635418 10.3140926,4.6455215 10.3244218,4.62485548 L10.3559094,4.59335646 C10.3662386,4.57235712 10.3714033,4.55152444 10.3714033,4.53085842 L10.4028908,4.46836037 L10.4028908,4.40586232 C10.4028908,4.29119924 10.3639062,4.19486892 10.285937,4.11687136 C10.2079678,4.0388738 10.1116725,3.99987502 9.99705113,3.99987502 C9.55955728,3.99987502 9.08574444,4.07537266 8.5756126,4.22636794 C8.06548077,4.37736322 7.5291926,4.59868963 6.96674811,4.89034718 C5.81087135,5.50499464 4.72796576,6.31230275 3.71803135,7.31227149 C3.20789953,7.8332552 2.73408668,8.38540462 2.29659282,8.96871973 C2.098671,8.66672917 1.95289525,8.34907242 1.85926557,8.0157495 C1.73431493,7.60942887 1.65617912,7.18760871 1.62485816,6.75028904 C1.5935372,6.31296937 1.59087159,5.94831409 1.61686132,5.65632322 C1.64285106,5.36433235 1.68716688,5.11434016 1.74980881,4.90634666 C1.87475945,4.45836067 2.04919055,4.05204003 2.2731021,3.68738475 C2.49701365,3.32272947 2.72875545,3.00507273 2.96832748,2.73441453 C3.20789951,2.46375632 3.55159709,2.22676373 3.9994202,2.02343675 C4.44724332,1.82010977 4.84025474,1.64828181 5.17845449,1.50795286 C5.51665423,1.36762392 6.02428704,1.25296083 6.70135294,1.16396362 C7.37841884,1.0749664 7.93803112,1.00463526 8.3801898,0.952970211 C8.82234847,0.90130516 9.49658215,0.864806301 10.4028908,0.843473634 C11.3091995,0.822140968 12.0407439,0.809141374 12.5975239,0.804474853 C13.154304,0.799808332 13.9951385,0.797141749 15.1200275,0.796475103 C14.1724018,5.84831723 12.4334221,9.07738299 9.90308824,10.4836724 C9.36163545,10.7856629 8.79669194,10.9966563 8.2082577,11.1166526 C7.61982346,11.2366488 7.07320604,11.2679812 6.56840544,11.2106496 C6.06360484,11.1533181 5.64193807,11.0856536 5.30340511,11.007656 C4.96487216,10.9296584 4.64982993,10.8281616 4.35827843,10.7031655 C4.31662822,10.6821662 4.26981338,10.6613335 4.21783391,10.6406675 L4.09288327,10.5781694 C4.0409038,10.5571701 3.99142334,10.5336708 3.9444419,10.5076716 C3.89746046,10.4816724 3.85314463,10.4530067 3.81149442,10.4216743 C3.79050271,10.4113413 3.76701199,10.4008416 3.74102226,10.3901753 C3.71503252,10.379509 3.6915418,10.3743425 3.67055009,10.3746758 L3.53010557,10.3746758 C3.50911386,10.3746758 3.48828875,10.3798423 3.46763025,10.3901753 L3.40515493,10.4216743 C3.38416322,10.4320073 3.36333811,10.4476735 3.34267961,10.4686728 L3.31119204,10.5001719 C3.29020034,10.5211712 3.27453985,10.5420039 3.2642106,10.5626699 C3.22256039,10.6253346 3.20173528,10.6929992 3.20173528,10.7656636 C3.20173528,10.838328 3.21989477,10.9059925 3.25621376,10.9686572 C3.29253275,11.0313219 3.33684858,11.0781538 3.38916124,11.1091528 C3.60774157,11.2444819 3.83165312,11.359145 4.0608959,11.4531421 C4.78994127,11.7447996 5.55530561,11.9271273 6.35698894,12.000125 C6.39863915,12.000125 6.44028936,12.0027916 6.48193958,12.0081247 C6.52358979,12.0134579 6.57040463,12.0161245 6.6223841,12.0161245 L6.74733475,12.0161245 C6.78898496,12.0161245 6.83063517,12.0187911 6.87228539,12.0241242 C6.9139356,12.0294574 6.95558582,12.032124 6.99723603,12.032124 C8.18443375,12.032124 9.28299982,11.7507994 10.2929342,11.1881504 C11.5840909,10.4695061 12.6878216,9.3185421 13.6041263,7.73525825 C14.1352498,6.81862023 14.6012324,5.75098692 15.0020741,4.53235834 C15.4029158,3.31372976 15.7334519,1.95960541 15.9936824,0.469985293 C16.0146741,0.3449892 15.9833532,0.235659285 15.8997195,0.141995546 L15.9002194,0.140495608 Z' class='svgTheme'></path>\r\n\t</g>\r\n\t</g>\r\n\t</g>\r\n\t</svg>"
          },
          "theme": "#56997C",
          "modules": [
            {
              "createTime": 1514862932000,
              "data": "[{\"content\":\"asfas\",\"createTime\":1514127342000,\"id\":50,\"status\":true,\"storeId\":107}]",
              "id": 974,
              "moduleId": 4,
              "moduleName": "信息公告模块",
              "sort": 0,
              "status": 1,
              "storeId": 3
            },
            {
              "createTime": 1514862932000,
              "data": "[{\"columns\":[{\"columnId\":468,\"columnTitle\":\"asfasf\",\"sort\":0},{\"columnId\":469,\"columnTitle\":\"asfafasf\",\"sort\":1}],\"formId\":230,\"remark\":\"\",\"status\":1,\"storeId\":107,\"title\":\"safasf\"},{\"columns\":[{\"columnId\":474,\"columnTitle\":\"Vhjj\",\"sort\":0},{\"columnId\":475,\"columnTitle\":\"Ccvh\",\"sort\":1}],\"formId\":233,\"remark\":\"\",\"status\":1,\"storeId\":107,\"title\":\"Ggh\"},{\"columns\":[{\"columnId\":478,\"columnTitle\":\"vhj 家\",\"sort\":0},{\"columnId\":479,\"columnTitle\":\"vghhgysua\",\"sort\":1}],\"formId\":235,\"remark\":\"\",\"status\":1,\"storeId\":107,\"title\":\"规划局回家\"}]",
              "id": 975,
              "moduleId": 3,
              "moduleName": "预约登记",
              "sort": 1,
              "status": 1,
              "storeId": 3
            },
            {
              "createTime": 1514862932000,
              "data": "[{\"coverUrl\":\"http://122.224.218.61:8001/group1/M00/00/CE/wKgCClo_rBCAePJtAARVJqS8E-4199.jpg\",\"createTime\":1514122085000,\"id\":291,\"maxPrice\":4.00,\"name\":\"Dgh\",\"originPrice\":4.00,\"status\":1,\"totalCurrentNum\":5}]",
              "id": 976,
              "moduleId": 2,
              "moduleName": "商品模块",
              "sort": 2,
              "status": 1,
              "storeId": 3,
              "typeId": 2
            }
          ]
        };
      var modules = msg.modules;
      var noticeData = "",
        formData = "",
        goodsData = "";
      modules.forEach(function(mdatas, index) {
        var moduleId = mdatas.moduleId;
        if (moduleId == 4) {
          noticeData = JSON.parse(mdatas.data);
        } else if (moduleId == 3) {
          formData = JSON.parse(mdatas.data);
        } else if (moduleId == 2) {
          var parseData = JSON.parse(mdatas.data);
          parseData.forEach(function(pdatas, ind) {
            pdatas.maxPrice = pdatas.maxPrice.toFixed(2);
            pdatas.originPrice = pdatas.originPrice.toFixed(2);
          })
          goodsData = parseData;
        }
      })
      
      var submitsData = {};
      formData.forEach(function(fd,fi){
        for(var ci in fd){
          var formId = fd.formId;

            submitsData[formId] = {};
              fd.columns.forEach(function(colid,id){
                var col = colid.columnId;
                submitsData[formId][col] = {
                  val:"",
                  sign:0
                };
                submitsData[formId].isSub = 0;
              })
                
                  
        }
      })
      
      if(noticeData[0].content.length>21){
        var noticeScroll = 1;
      };

      // msg.theme = "#303030";
      if(msg.theme == "#303030"){
        var darkColor = 1;
      }else{
        var darkColor = 0;
      }
      var templateId = me.data.storeData.templateId;
      //var templateId = 1;
      var RGBcolor = me.toRGB(msg.theme);//主题颜色转换为rgb格式
      var themeColor = {
        bodyColor: templateId == 1 ? "#fff" : "rgba(" + RGBcolor + ",0.3)",
        Color: msg.theme,
        colorTheme6: "rgba(" + RGBcolor + ",0.6)",
        inputTheme: darkColor ? "rgba(" + RGBcolor + ",0.1)" : "rgba(" + RGBcolor + ",0.2)",
        colorTheme5: darkColor ? "rgba(" + RGBcolor + ",0.5)" : msg.theme,
        templateId: templateId
      };
      
      me.setData({
        modulesData: modules,
        noticeData: noticeData[0],//公告数据
        formData: formData,//表单数据
        goodsData: goodsData,//商品数据
        submitsData: submitsData,
        noticeScroll: noticeScroll,
        themeColor:themeColor
      })
    })
  },
  //点击购物车按钮
  isAddToCar: function(event) {
    var me = this;
    var goodsId = event.currentTarget.dataset.goodsid;
    addToCar.isAddToCarFn(me,goodsId);
  },
  //关闭加入购物车弹框
  cutAddToCar: function() {
    var me = this;
    addToCar.cutAddToCarCommon(me);
  },
  //选中商品属性
  selectSku: function(event) {
    var me = this;
    addToCar.selectAttrValue(event,me);
  },
  //改变商品数量
  changeNumTap: function(event){
    var me = this;
    addToCar.changeNumTapFn(event,me);
  },
  //输入数量
  bindblurtap: function(event){
    var me = this;
    addToCar.bindblurtapFn(event,me);
  },
  addToCarBtn: function(event){
    var me = this;
    addToCar.addToCarBtnFn(event,me);
    
  },
  bindblurForm: function(event){
    var me = this;
    var submitsData = me.data.submitsData;
    var formId = event.currentTarget.dataset.formid;
    var columnId = event.currentTarget.dataset.columnid;
    var inputVal = event.detail.value;

    submitsData[formId][columnId] = {
      sign:0,
      val:inputVal
    }
    
    me.setData({
      submitsData: submitsData
    })

  },
  formSubmit:function(event){
    var me = this;
    var msg = me.data.submitsData;
    var formData = me.data.formData;
    var formId = event.currentTarget.dataset.formid;
    var thData = msg[formId];
    var subData = [];
    var isSub = thData.isSub;
    
    if(isSub){
      wx.showToast({
        title: '请勿重复提交',
        image: '/imgs/forbidden.png'
      });
      return false;
    }
    
    for(var i in msg[formId]){
      if(msg[formId][i].val==""){
        msg[formId][i].sign = 1;
        me.setData({
          submitsData: msg
        });
        return false;
      }else{
        if(i!="isSub"){
          subData.push({
              "formId" : formId,
              "columnId" : i,
              "content" : msg[formId][i].val
          })
        }
      }
    };
    var params = {
        /*"storeId" : 2,*/
        "formId" : formId,
        "data" : JSON.stringify(subData)
    };
    utils.ajaxFn("form/submitAnswer.do", params, function(msgs) {
        wx.showToast({
          title: '表单提交成功'
        });
        msg[formId].isSub = 1;
        me.setData({
          submitsData: msg
        });
    })
  },
  toRGB: function (string) {
    var sColor = string.toLowerCase();
    //十六进制颜色值的正则表达式
    var reg = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;
    var resColor = "";
    // 如果是16进制颜色
    if (sColor && reg.test(sColor)) {
      if (sColor.length === 4) {
        var sColorNew = "#";
        for (var i = 1; i < 4; i += 1) {
          sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));
        }
        sColor = sColorNew;
      }
      //处理六位的颜色值
      var sColorChange = [];
      for (var i = 1; i < 7; i += 2) {
        sColorChange.push(parseInt("0x" + sColor.slice(i, i + 2)));
      }
      //return "RGB(" + sColorChange.join(",") + ")";
      resColor = sColorChange.join(",");
    }
    return resColor;
  },
  onShareAppMessage: function (res) {
      return {
        title: this.data.storeData.storeName,
        path: '/pages/index/index',
        imageUrl: this.data.storeData.backPic,
        success: function(res) {
          // 转发成功
          // wx.showToast({
          //   title: '转发成功'
          // })
        },
        fail: function(res) {
          // 转发失败
        }
      }
    },
  gotoDetail:function(event){
    var goodsId = event.currentTarget.dataset.goodsid;
    wx.navigateTo({
      url: '../goodsDetail/goodsDetail?goodsId='+goodsId
    })
  }
})